<!DOCTYPE html>
<html lang="ja">


<head>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database-compat.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é£Ÿäº‹è¨˜éŒ²ã‚·ã‚¹ãƒ†ãƒ </title>

  <!-- ãƒ•ã‚©ãƒ³ãƒˆã¨Firebase -->
  <link href="https://fonts.googleapis.com/css2?family=Kiwi+Maru&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Kiwi Maru', sans-serif;
      margin: 20px;
      background-color: #fff0f5;
      color: #444;
    }
    h1, h2 {
      text-align: center;
      color: #d63384;
    }
    form, #searchForm {
      margin-bottom: 20px;
      padding: 15px;
      background-color: #fff;
      border: 2px dashed #f5c2e7;
      border-radius: 15px;
      box-shadow: 0 3px 10px rgba(255, 192, 203, 0.2);
    }
    input, select, button {
      margin-bottom: 12px;
      padding: 10px;
      border: 1px solid #f5c2e7;
      border-radius: 12px;
      width: 100%;
      font-size: 1em;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    button {
      background-color: #ffb6c1;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
      font-weight: bold;
    }
    button:hover {
      background-color: #ff6fa1;
    }
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 8px;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ffe0f0;
      padding: 10px;
      text-align: center;
      background-color: #fffafc;
      border-radius: 10px;
    }
    th {
      background-color: #ffe0f0;
      color: #a3006b;
    }
    .sortable {
      cursor: pointer;
      color: #ff69b4;
      text-decoration: underline;
    }
    .sortable:hover {
      color: #ff1493;
    }
    .delete-btn, .edit-btn {
      padding: 6px 12px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
    }
    .delete-btn {
      background-color: #ff6b6b;
    }
    .edit-btn {
      background-color: #87cefa;
    }
    #counts {
      margin-top: 20px;
      display: flex;
      justify-content: space-between;
      gap: 20px;
    }
    .count-card {
      flex: 1;
      padding: 20px;
      text-align: center;
      background-color: #fff;
      border: 2px solid #ffe0f0;
      border-radius: 20px;
      box-shadow: 0 5px 10px rgba(255, 105, 180, 0.2);
    }
    .count-card h3 {
      font-size: 1.2em;
      margin-bottom: 10px;
      color: #d63384;
    }
    .count-card span {
      font-size: 2.5em;
      font-weight: bold;
    }
    .count-card:nth-child(1) span { color: #f78fb3; }
    .count-card:nth-child(2) span { color: #63cdda; }
    .count-card:nth-child(3) span { color: #a29bfe; }
  </style>
</head>
<body>
  <h1>é£Ÿäº‹è¨˜éŒ²ã‚·ã‚¹ãƒ†ãƒ </h1>

  <form id="mealForm">
    <label for="date">æ—¥ä»˜</label>
    <input type="date" id="date" required>

    <label for="mealType">è‡ªç‚Šãƒ»å¤–é£Ÿãƒ»å­¦é£Ÿ</label>
    <select id="mealType" required>
      <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
      <option value="è‡ªç‚Š">è‡ªç‚Š</option>
      <option value="å¤–é£Ÿ">å¤–é£Ÿ</option>
      <option value="å­¦é£Ÿ">å­¦é£Ÿ</option>
    </select>

    <label for="mealTime">æ˜¼é£Ÿãƒ»å¤œé£Ÿ</label>
    <select id="mealTime" required>
      <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
      <option value="æ˜¼é£Ÿ">æ˜¼é£Ÿ</option>
      <option value="å¤œé£Ÿ">å¤œé£Ÿ</option>
    </select>

    <label for="food">é£Ÿã¹ãŸã‚‚ã®</label>
    <input type="text" id="food" placeholder="ä¾‹: ãƒ©ãƒ¼ãƒ¡ãƒ³" required>

    <button type="button" onclick="addOrUpdateMeal()" id="submitBtn">è¿½åŠ </button>
  </form>

  <form id="searchForm">
    <label for="search">æ¤œç´¢</label>
    <input type="text" id="search" placeholder="ä¾‹: ãƒ©ãƒ¼ãƒ¡ãƒ³ã€è‡ªç‚Š" oninput="searchMeals()">
  </form>

  <h2>è¨˜éŒ²ä¸€è¦§</h2>
  <table id="mealTable">
    <thead>
      <tr>
        <th class="sortable" onclick="sortTableByDate()">æ—¥ä»˜</th>
        <th>ç¨®é¡</th>
        <th>æ˜¼é£Ÿ/å¤œé£Ÿ</th>
        <th>é£Ÿã¹ãŸã‚‚ã®</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="counts">
    <div class="count-card"><h3>è‡ªç‚Š</h3><span id="selfCookCount">0</span> å›</div>
    <div class="count-card"><h3>å¤–é£Ÿ</h3><span id="dineOutCount">0</span> å›</div>
    <div class="count-card"><h3>å­¦é£Ÿ</h3><span id="schoolCount">0</span> å›</div>
  </div>

  <div id="ranking">
    <h2>é£Ÿã¹ãŸã‚‚ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
    <table>
      <thead>
        <tr><th>é †ä½</th><th>é£Ÿã¹ãŸã‚‚ã®</th><th>å›æ•°</th></tr>
      </thead>
      <tbody id="foodRanking"></tbody>
    </table>
  </div>



  <script>

    // ğŸ”§ FirebaseåˆæœŸåŒ–
    const firebaseConfig = {
  apiKey: "AIzaSyCovkbkJ-UHZp8kE9-yxRtgG94lIxPfgJg",
  authDomain: "dinner-66935.firebaseapp.com",
  databaseURL: "https://dinner-66935-default-rtdb.firebaseio.com",
  projectId: "dinner-66935",
  storageBucket: "dinner-66935.firebasestorage.app",
  messagingSenderId: "489132414093",
  appId: "1:489132414093:web:8a9b5e6fd37a5b89303ec4",
  measurementId: "G-6SHM0QTS0Y"
};

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const ref = db.ref("meals");

    let meals = {};
let editKey = null;

// Firebaseã‹ã‚‰å–å¾—
ref.on("value", snapshot => {
  meals = snapshot.val() || {};
  renderTable();
  renderCounts();
  renderRanking();
});

function addOrUpdateMeal() {
  const date = dateInput.value;
  const mealType = mealTypeInput.value;
  const mealTime = mealTimeInput.value;
  const food = foodInput.value;
  if (!date || !mealType || !mealTime || !food) return alert("ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");

  const data = { date, mealType, mealTime, food };

  if (editKey) {
    ref.child(editKey).set(data); // ç·¨é›†
    editKey = null;
    submitBtn.innerText = "è¿½åŠ ";
  } else {
    ref.push(data); // æ–°è¦è¿½åŠ 
  }

  mealForm.reset();
  const now = new Date();
  now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
  dateInput.value = now.toISOString().split("T")[0];
}

function confirmDelete(key) {
  const m = meals[key];
  if (confirm(`å‰Šé™¤ã—ã¦ã„ã„ã§ã™ã‹ï¼Ÿ\n${m.date} ${m.mealType} ${m.mealTime} ${m.food}`)) {
    ref.child(key).remove();
  }
}

function editMeal(key) {
  const m = meals[key];
  dateInput.value = m.date;
  mealTypeInput.value = m.mealType;
  mealTimeInput.value = m.mealTime;
  foodInput.value = m.food;
  editKey = key;
  submitBtn.innerText = "ä¿å­˜";
}

function renderTable(filtered = meals) {
  const tbody = document.querySelector("#mealTable tbody");
  tbody.innerHTML = "";
  for (const key in filtered) {
    const m = filtered[key];
    tbody.innerHTML += `<tr>
      <td>${m.date}</td>
      <td>${m.mealType}</td>
      <td>${m.mealTime}</td>
      <td>${m.food}</td>
      <td>
        <button class='edit-btn' onclick='editMeal("${key}")'>ç·¨é›†</button>
        <button class='delete-btn' onclick='confirmDelete("${key}")'>å‰Šé™¤</button>
      </td>
    </tr>`;
  }
}


function renderCounts() {
  const all = Object.values(meals);
  selfCookCount.innerText = all.filter(m => m.mealType === "è‡ªç‚Š").length;
  dineOutCount.innerText = all.filter(m => m.mealType === "å¤–é£Ÿ").length;
  schoolCount.innerText = all.filter(m => m.mealType === "å­¦é£Ÿ").length;
}

function renderRanking() {
  const counts = {};
  for (const m of Object.values(meals)) {
    counts[m.food] = (counts[m.food] || 0) + 1;
  }
  const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);
  foodRanking.innerHTML = sorted.map(([f, c], i) =>
    `<tr><td>${i + 1} ä½</td><td>${f}</td><td>${c} å›</td></tr>`
  ).join('');
}

function searchMeals() {
  const q = search.value.toLowerCase();
  const filtered = {};
  for (const key in meals) {
    const m = meals[key];
    if (
      m.date.includes(q) ||
      m.mealType.includes(q) ||
      m.mealTime.includes(q) ||
      m.food.includes(q)
    ) {
      filtered[key] = m;
    }
  }
  renderTable(filtered); 
}

const dateInput = document.getElementById("date");
const mealTypeInput = document.getElementById("mealType");
const mealTimeInput = document.getElementById("mealTime");
const foodInput = document.getElementById("food");
const mealForm = document.getElementById("mealForm");
const submitBtn = document.getElementById("submitBtn");
const search = document.getElementById("search"); // ğŸ”‘ searchMealsç”¨
const selfCookCount = document.getElementById("selfCookCount");
const dineOutCount = document.getElementById("dineOutCount");
const schoolCount = document.getElementById("schoolCount");
const foodRanking = document.getElementById("foodRanking");

  </script>
</body>
</html>
